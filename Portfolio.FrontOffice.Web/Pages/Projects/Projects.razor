@attribute [Route("/" + Portfolio.FrontOffice.Web.Routing.WebRoutes.Projects)]
@using Portfolio.FrontOffice.Common
@using Portfolio.FrontOffice.Web.Pages.Projects
@inject HttpClient Http

<Spinner IsLoading=@isLoading>
    @foreach (var project in projectModels)
    {
        <ProjectCard ProjectModel=@project 
                     EmployerName=@employers.SingleOrDefault(e => e.EmployerId == project.EmployerId)?.Name />
    }
</Spinner>

@code {
    private bool isLoading = true;

    private EmployerModel[] employers;

    private ProjectModel[] projectModels;

    protected override async Task OnInitializedAsync()
    {
        Task<EmployerModel[]> employersDownload = Http.GetFromJsonAsync<EmployerModel[]>(ApiRoutes.Employers);
        Task<ProjectModel[]> projectsDownload = Http.GetFromJsonAsync<ProjectModel[]>(ApiRoutes.Projects);

        employers = await employersDownload;
        projectModels = await projectsDownload;
        
        isLoading = false;
    }
}
